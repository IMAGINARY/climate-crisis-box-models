function t(){return(t=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}function r(t,r,n,o){for(var a=t.length,e=o(t,r),s=Array(a),i=n/2,u=n/6,c=r+i,f=0;f<a;f+=1)s[f]=t[f]+i*e[f];for(var l=o(s,c),d=0;d<a;d+=1)s[d]=t[d]+i*l[d];for(var h=o(s,c),v=0;v<a;v+=1)s[v]=t[v]+n*h[v],h[v]+=l[v];return l=o(s,r+n),t.map(function(r,n){return t[n]+u*(e[n]+l[n]+2*h[n])})}exports.BoxModel=function(){function n(o,a){var e=o.stocks,s=o.flows,i=o.variables,u=o.constants;void 0===a&&(a=r),this.stocks=e,this.flows=s,this.variables=i,this.constants=u,this.integrator=a,this.ensureUniqueIds(),this.idToIdx=t({},n.createIdToIdxMap(e),n.createIdToIdxMap(i),n.createIdToIdxMap(u),n.createIdToIdxMap(s))}var o=n.prototype;return o.ensureUniqueIds=function(){var t=[].concat(this.stocks,this.variables,this.constants,this.flows).map(function(t){return t.id}).reduce(function(t,r,n,o){return o.lastIndexOf(r)!==n&&o.push(r),t},[]);if(t.length>0)throw new Error("Duplicate ids found: "+t)},n.createIdToIdxMap=function(t){var r={};return t.forEach(function(t,n){return r[t.id]=n}),r},o.evaluateGraph=function(t,r){var n=this,o=function(r){return t[n.idToIdx[r]]},a=this.constants.map(function(t){return t.value}),e=function(t){return a[n.idToIdx[t]]},s=function(t){var a=new Array(t.length);return{evaluator:function(s){var i=n.idToIdx[s];if(null===a[i])throw new Error("Evaluation cycle detected starting at: ${id}");return void 0===a[i]&&(a[i]=null,a[i]=t[i].equation(o,l,u,e,r)),a[i]},data:a}},i=s(this.variables),u=i.evaluator,c=i.data,f=s(this.flows),l=f.evaluator,d=f.data;return this.variables.forEach(function(t){return u(t.id)}),this.flows.forEach(function(t){return l(t.id)}),{stocks:t,flows:d,variables:c,constants:a}},o.step=function(t,r,n){return this.stepExt(t,r,n).stocks},o.stepExt=function(t,r,n){var o=this,a=this.integrator(t,r,n,function(t,r){var n=o.evaluateGraph(t,r).flows,a=function(t){return n[o.idToIdx[t]]},e=function(t){return t.map(function(t){return a(t)}).reduce(function(t,r){return t+r},0)};return t.map(function(t,r){return e(o.stocks[r].in)-e(o.stocks[r].out)})}),e=this.evaluateGraph(a,r+n);return{stocks:a,variables:e.variables,constants:e.constants,flows:e.flows}},n}(),exports.euler=function(t,r,n,o){var a=o(t,r);return t.map(function(r,o){return t[o]+n*a[o]})},exports.rk4=r;
//# sourceMappingURL=box-model.js.map
